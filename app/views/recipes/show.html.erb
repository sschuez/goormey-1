<%# METADATA %>
<% content_for :meta_title, "#{@recipe.name} - #{DEFAULT_META["meta_product_name"]}" %>
<% content_for :meta_description, @recipe.description %>
<% if @recipe.photo.attached? %>
  <% content_for :meta_image, cl_image_path(@recipe.photo.key) %>
<% else %>
  <% content_for :meta_image, cl_image_path("sample_meal.jpg") %>
<% end %>
<%# /METADATA %>
  
<%#= turbo_frame_tag "recipe" do %>
  <%# ACTION BUTTON TOP %>
  <div class="action-btns">
    <%= link_to 'Back to recipes', recipes_path, class: "recipes-btn btn-ghost", "data-turbo-frame": "_top" %>
    <% if policy(@recipe).update? %>
      <%= link_to edit_recipe_path(@recipe) do %>
        <i class="show-icon fas fa-edit"></i>
      <% end %>
    <% end %>

    <% if policy(@recipe).destroy? %>
      <%= link_to recipe_path(@recipe), data: {
        turbo_method: :delete,
        turbo_confirm: "Are you sure you want to delete recipe #{@recipe.name}?"
        }, "data-turbo-frame": "_top" do %>
        <i class="show-icon fas fa-trash-alt"></i>
      <% end %>
    <% end %>
  </div>

  <div class="main-card recipe">
    
    <%# PHOTO %>
    <div class="photo-show">
      <% if @recipe.photo.attached? %>
        <%= cl_image_tag @recipe.photo.key, :transformation=>[
          {:width=>800, :height=>800}], 
          class: "card-image" %>
      <% else %>
        <%= image_tag "sample_meal.jpg", class: "card-image", :width=>200 %>
      <% end %>
    </div>

    <%# DESCRIPTION %>
    <div class="description-show">
      <h4><%= @recipe.name %></h4>
      <p><%= @recipe.description %></p>
      
      <%# USER AVATAR %>
      <div class="user-show">
        <%= link_to user_path(@recipe.user) do %>
          <% if @recipe.user.avatar.attached? %> 
            <%= cl_image_tag @recipe.user.avatar.key, :transformation=>[
              {:width=>200, :height=>200, :gravity=>"face", :radius=>"max", :crop=>"thumb"}], 
              class: "card-recipe-user avatar", 'aria-haspopup': true, 'aria-expanded': false %>
          <% else %>
            <%= image_tag "default_avatar_square.png", class: "card-recipe-user avatar", alt: "avatar", 'aria-haspopup': true, 'aria-expanded': false %>
          <% end %>
        <% end %>

        <%# USER NAME %>
        <div class="user-name">
          <%= link_to user_path(@recipe.user) do %>
            <small><p><%= @recipe.user.full_name %></p></small>
          <% end %>
        </div>
        
      </div>

      <%# LIKE BUTTON %>
      <div data-controller="like" class="card-recipe-like" data-like-url="/recipes/<%= @recipe.id %>/likes">
        <i data-action="click->like#save" data-like-target="heart" class="<%= liked?(@recipe) %> fa-heart"></i>
      </div>
      
      <%# EDIT BUTTON %>
      <% if policy(@recipe).update? %>
        <br>
        <%= link_to 'Edit description', edit_recipe_path(@recipe, anchor: "edit-recipe"), class: "btn btn-ghost btn-coral" %>
        <%# OLD LINK TO WIZARD %>
        <%#= link_to 'Edit description', recipe_step_path(@recipe, :recipe), class: "btn btn-ghost btn-coral" %>
      <% end %>
    </div>
  </div>

  <%# INGREDIENTS %>
  <div class="main-card">
    <h4>Ingredients</h4>
    <p>Ingredients serve <strong><%= @recipe.serves %></strong> <%= @recipe.serves == 1 ? "person" : "persons" %></p>
    <% @recipe.ingredients.each do |ingredient| %>
      <div class="ingredient-show">
        <p><%= ingredient.description %></p>
      </div>
    <% end %>
    <% if policy(@recipe).update? %>
      <br>
      <%= link_to 'Edit ingredients', edit_recipe_path(@recipe, anchor: "edit-ingredients"), class: "btn btn-ghost btn-coral" %>
    <% end %>
  </div>

  <%# INSTRUCITONS %>
  <div data-controller="nested-form" class="main-card">
    <h4>Instructions</h4>
    <% @recipe.instructions.each do |instruction| %>
      <div data-nested-form-target="inputElement" class="ingredient-show">
        <div class="counter"><h4></h4></div>
        <div class="instruction-description"><p>
          <%= instruction.description %>
        </p>
        </div>
      </div>
    <% end %>
    <% if policy(@recipe).update? %>
      <br>
      <%= link_to 'Edit instructions', edit_recipe_path(@recipe, anchor: "edit-instructions"), class: "btn btn-ghost btn-coral" %>
    <% end %>
  </div>

  <div class="main-card">
    <% if user_signed_in? %>
      <%= render partial: "comments/form" %>
    <% else %>
      <p>
        <strong><%= link_to "Sign up", new_user_registration_path %></strong> or <strong><%= link_to "login", new_user_session_path %></strong> to comment
      </p>
    <% end %>
    <br>
    <h4>Comments</h4>
    <br>
    <div id="comments">
      <%= render @recipe.comments.order(created_at: :desc) %>
    </div>
    
  </div>

  <div class="main-card">
    <!-- comments container -->
    <div class="comment_block">

      <div class="create_new_comment">
        <% if user_signed_in? %>
          <%= render partial: "comments/form" %>
        <% else %>
          <p>
            <strong><%= link_to "Sign up", new_user_registration_path %></strong> or <strong><%= link_to "login", new_user_session_path %></strong> to comment
          </p>
        <% end %>
      </div>


         <!-- new comment -->
         <div class="new_comment">

          <!-- build comment -->
          <ul class="user_comment">

            <!-- current #{user} avatar -->
            <div class="user_avatar">
              <img src="https://s3.amazonaws.com/uifaces/faces/twitter/dancounsell/73.jpg">
            </div><!-- the comment body --><div class="comment_body">
              <p>Gastropub cardigan jean shorts, kogi Godard PBR&B lo-fi locavore. Organic chillwave vinyl Neutra. Bushwick Helvetica cred freegan, crucifix Godard craft beer deep v mixtape cornhole Truffaut master cleanse pour-over Odd Future beard. Portland polaroid iPhone.</p>
            </div>

            <!-- comments toolbar -->
            <div class="comment_toolbar">

              <!-- inc. date and time -->
              <div class="comment_details">
                <ul>
                  <li><i class="fa fa-clock-o"></i> 13:94</li>
                  <li><i class="fa fa-calendar"></i> 04/01/2015</li>
                  <li><i class="fa fa-pencil"></i> <span class="user">John Smith</span></li>
                </ul>
              </div><!-- inc. share/reply and love --><div class="comment_tools">
                <ul>
                  <li><i class="fa fa-share-alt"></i></li>
                  <li><i class="fa fa-reply"></i></li>
                  <li><i class="fa fa-heart love"></i></li>
                </ul>
              </div>

            </div>

            <!-- start user replies -->
          <li>
		 		
            <!-- current #{user} avatar -->
            <div class="user_avatar">
              <img src="https://s3.amazonaws.com/uifaces/faces/twitter/manugamero/73.jpg">
            </div><!-- the comment body --><div class="comment_body">
              <p><div class="replied_to"><p><span class="user">John Smith:</span>Gastropub cardigan jean shorts, kogi Godard PBR&B lo-fi locavore. Organic chillwave vinyl Neutra. Bushwick Helvetica cred freegan, crucifix Godard craft beer deep v mixtape cornhole Truffaut master cleanse pour-over Odd Future beard. Portland polaroid iPhone.</p></div>That's exactly what I was thinking!</p>
            </div>

            <!-- comments toolbar -->
            <div class="comment_toolbar">

              <!-- inc. date and time -->
              <div class="comment_details">
                <ul>
                  <li><i class="fa fa-clock-o"></i> 14:52</li>
                  <li><i class="fa fa-calendar"></i> 04/01/2015</li>
                  <li><i class="fa fa-pencil"></i> <span class="user">Andrew Johnson</span></li>
                </ul>
              </div><!-- inc. share/reply and love --><div class="comment_tools">
                <ul>
                  <li><i class="fa fa-share-alt"></i></li>
                  <li><i class="fa fa-reply"></i></li>
                  <li><i class="fa fa-heart love"><span class="love_amt"> 4</span></i></li>
                </ul>
              </div>

            </div>


          </li>

            <!-- start user replies -->
          <li>
		 		
            <!-- current #{user} avatar -->
            <div class="user_avatar">
              <img src="https://s3.amazonaws.com/uifaces/faces/twitter/ManikRathee/73.jpg">
            </div><!-- the comment body --><div class="comment_body">
              <p><div class="replied_to"><p><span class="user">John Smith:</span>Gastropub cardigan jean shorts, kogi Godard PBR&B lo-fi locavore. Organic chillwave vinyl Neutra. Bushwick Helvetica cred freegan, crucifix Godard craft beer deep v mixtape cornhole Truffaut master cleanse pour-over Odd Future beard. Portland polaroid iPhone.</p></div>Finally someone who actually gets it!<div class="replied_to"><p><span class="user">Andrew Johnson:</span>That's exactly what I was thinking!</p></div>That's awesome!</p>
            </div>

            <!-- comments toolbar -->
            <div class="comment_toolbar">

              <!-- inc. date and time -->
              <div class="comment_details">
                <ul>
                  <li><i class="fa fa-clock-o"></i> 14:59</li>
                  <li><i class="fa fa-calendar"></i> 04/01/2015</li>
                  <li><i class="fa fa-pencil"></i> <span class="user">Simon Gregor</span></li>
                </ul>
              </div><!-- inc. share/reply and love --><div class="comment_tools">
                <ul>
                  <li><i class="fa fa-share-alt"></i></li>
                  <li><i class="fa fa-reply"></i></li>
                  <li><i class="fa fa-heart love"><span class="love_amt"> 4039</span></i></li>
                </ul>
              </div>

            </div>


          </li>

          </ul>

         </div>

    <!-- new comment -->
         <div class="new_comment">

          <!-- build comment -->
          <ul class="user_comment">

            <!-- current #{user} avatar -->
            <div class="user_avatar">
              <img src="https://s3.amazonaws.com/uifaces/faces/twitter/kfriedson/73.jpg">
            </div><!-- the comment body --><div class="comment_body">
              <p>Gastropub cardigan jean shorts, kogi Godard PBR&B lo-fi locavore. Organic chillwave vinyl Neutra. Bushwick Helvetica cred freegan, crucifix Godard craft beer deep v mixtape cornhole Truffaut master cleanse pour-over Odd Future beard. Portland polaroid iPhone.</p>
            </div>

            <!-- comments toolbar -->
            <div class="comment_toolbar">

              <!-- inc. date and time -->
              <div class="comment_details">
                <ul>
                  <li><i class="fa fa-clock-o"></i> 13:94</li>
                  <li><i class="fa fa-calendar"></i> 04/01/2015</li>
                  <li><i class="fa fa-pencil"></i> <span class="user">Sarah Walkman</span></li>
                </ul>
              </div><!-- inc. share/reply and love --><div class="comment_tools">
                <ul>
                  <li><i class="fa fa-share-alt"></i></li>
                  <li><i class="fa fa-reply"></i></li>
                  <li><i class="fa fa-heart love"></i></li>
                </ul>
              </div>

            </div>

            <!-- start user replies -->
          <li>
		 		
            <!-- current #{user} avatar -->
            <div class="user_avatar">
              <img src="https://s3.amazonaws.com/uifaces/faces/twitter/cbillins/73.jpg">
            </div><!-- the comment body --><div class="comment_body">
              <p><div class="replied_to"><p><span class="user">Sarah Walkman:</span>Pork belly migas flexitarian messenger bag Brooklyn gluten-free. Tilde kitsch skateboard Helvetica, lumbersexual four loko direct trade pour-over. Cronut deep v keffiyeh cornhole food truck</p></div>I'm tired, does anybody know a good place to buy extra strength coffee?</p>
            </div>

            <!-- comments toolbar -->
            <div class="comment_toolbar">

              <!-- inc. date and time -->
              <div class="comment_details">
                <ul>
                  <li><i class="fa fa-clock-o"></i> 19:23</li>
                  <li><i class="fa fa-calendar"></i> 14/01/2015</li>
                  <li><i class="fa fa-pencil"></i> <span class="user">Blake Anderson</span></li>
                </ul>
              </div><!-- inc. share/reply and love --><div class="comment_tools">
                <ul>
                  <li><i class="fa fa-share-alt"></i></li>
                  <li><i class="fa fa-reply"></i></li>
                  <li><i class="fa fa-heart love"><span class="love_amt"> 12</span></i></li>
                </ul>
              </div>

            </div>


          </li>

          </ul>

         </div>

        </div>
  </div>
<br>
<div class="action-btns">
  <%= link_to 'Back to recipes', recipes_path, class: "recipes-btn btn-ghost", "data-turbo-frame": "_top" %>
    
  <% if policy(@recipe).update? %>
    <%= link_to edit_recipe_path(@recipe) do %>
      <i class="show-icon fas fa-edit"></i>
    <% end %>
  <% end %>

  <% if policy(@recipe).destroy? %>
    <%= link_to recipe_path(@recipe), data: {
      turbo_method: :delete,
      turbo_confirm: "Are you sure you want to delete recipe #{@recipe.name}?"
      }, "data-turbo-frame": "_top" do %>
      <i class="show-icon fas fa-trash-alt"></i>
    <% end %>
  <% end %>
</div>

<%# end %>

